(()=>{var e={543:()=>{const e=document.querySelector(".img-upload__input"),t=document.querySelector(".img-upload__preview"),r=["gif","jpg","jpeg","png"];e.addEventListener("change",(()=>{const o=e.files[0],n=o.name.toLowerCase();if(r.some((e=>n.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{t.childNodes[1].src=e.result})),e.readAsDataURL(o)}}))},136:()=>{const e=/^#[\wа-яa-z]{1,19}$/i,t=document.querySelector(".text__hashtags"),r=document.querySelector(".text__description"),o="Хэштеги должны быть разные",n="Хэштег должен начинаться с символа '#', не может содержать один символ '#', может содержать только буквы и числа ",c="Хэштегов не должно быть больше пяти",s="Длина одного хэштега не может быть больше 20 символов";t.addEventListener("input",(()=>{const r=t.value.toLowerCase().trim().split(" "),l=new Set(r);r.forEach((i=>{t.value?i.length>20?t.setCustomValidity(s):r.length>=5?t.setCustomValidity(c):r.length!==l.size?t.setCustomValidity(o):e.test(i)?(t.value,t.setCustomValidity("")):t.setCustomValidity(n):t.setCustomValidity(""),t.reportValidity()}))})),r.addEventListener("input",(()=>{const e=r.value.length;r.setCustomValidity(""),140<e&&r.setCustomValidity("Длина комментария не должная быть больше 140 символов"),r.reportValidity()}))}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,r),c.exports}(()=>{"use strict";const e=e=>"Escape"===e.key,t=document.querySelector(".img-upload__effect-level"),o=document.querySelector(".effects__list"),n=document.querySelector(".effect-level__value"),c=document.querySelector(".img-upload__preview img"),s=document.querySelector(".effect-level__slider"),l=(e,r,o,n)=>{t.classList.remove("hidden"),noUiSlider.create(s,{range:{min:e,max:r},start:o,step:n,connect:"lower",format:{to:function(e){return Number.isInteger(e)?e.toFixed(0):e.toFixed(1)},from:function(e){return parseFloat(e)}}})},i=()=>{t.classList.add("hidden"),s.noUiSlider.destroy()};o.addEventListener("change",(e=>{if(e.target.matches(".effects__radio")){switch(s.noUiSlider&&i(),e.target.value){case"chrome":l(0,1,1,.1);break;case"sepia":l(0,1,1,.01);break;case"marvin":l(0,100,100,1);break;case"phobos":l(0,3,3,.1);break;case"heat":l(1,3,3,.1);break;case"none":l(0,1,1,.1)}c.classList.add(`effects__preview--${e.target.value}`),t=e.target.value,s.noUiSlider.on("update",((e,r)=>{switch(t){case"chrome":c.style.filter="none",c.style.filter=`grayscale(${e[r]})`;break;case"sepia":c.style.filter="none",c.style.filter=`sepia(${e[r]})`;break;case"marvin":c.style.filter="none",c.style.filter=`invert(${e[r]}%)`;break;case"phobos":c.style.filter="none",c.style.filter=`blur(${e[r]}px)`;break;case"heat":c.style.filter="none",c.style.filter=`brightness(${e[r]})`;break;case"none":c.style.filter="none",i()}n.value=e[r]}))}var t}));const a=document.querySelector("main"),d=document.querySelector("#error").content.querySelector(".error"),u=document.querySelector("#success").content.querySelector(".success"),m=t=>{const r=()=>{t.remove(),document.removeEventListener("keydown",o)},o=t=>{e(t)&&r()};a.appendChild(t),t.addEventListener("click",(()=>r())),document.addEventListener("keydown",o)},y="https://22.javascript.pages.academy/kekstagram",v="Не удалось отправить форму. Попробуйте еще раз",p=100,g=document.querySelector(".img-upload__form"),f=document.querySelector("#upload-file"),h=g.querySelector(".img-upload__overlay"),S=document.querySelector("#upload-cancel"),q=h.querySelector(".img-upload__preview img"),L=h.querySelector(".scale__control--value"),k=h.querySelector(".scale__control--bigger"),b=h.querySelector(".scale__control--smaller"),E=document.querySelector(".text__hashtags"),x=document.querySelector(".text__description");L.value=p;let C=100;const w=t=>{e(t)&&E!==document.activeElement&&x!==document.activeElement&&$()},$=()=>{h.classList.add("hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",w),f.value="",E.value="",x.value=""},V=()=>{(()=>{const e=u.cloneNode(!0);m(e)})(),$()},F=()=>{(()=>{const e=d.cloneNode(!0);m(e)})(),$()};f.addEventListener("click",(()=>{h.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",w),t.classList.add("hidden"),c.style.filter="none",c.style.transform="",L.value="100%",q.style.transform="none",q.src="img/upload-default-image.jpg"})),S.addEventListener("click",$),k.addEventListener("click",(()=>{C>=25&&C<p&&(C+=25,L.value=`${C}%`,q.style.transform=`scale(${C/p})`)})),b.addEventListener("click",(()=>{C>25&&C<=p&&(C-=25,L.value=`${C}%`,q.style.transform=`scale(${C/p})`)}));let N,j,D=[];const U=document.querySelector("body"),z=document.querySelector(".big-picture"),A=z.querySelector(".big-picture__img img"),T=z.querySelector(".likes-count"),I=z.querySelector(".comments-count"),R=z.querySelector(".comments-shown"),H=z.querySelector(".social__comments"),M=z.querySelector(".social__caption"),O=z.querySelector(".comments-loader"),P=z.querySelector(".big-picture__cancel"),W=H.querySelector(".social__comment"),B=()=>{G(D),j+=5,j>=N&&(j=N),R.textContent=j,0===D.length&&O.classList.add("hidden")},G=e=>{const t=(e=>{const t=document.createDocumentFragment();return e.forEach((e=>{const r=(({avatar:e,name:t,message:r})=>{const o=W.cloneNode(!0),n=o.querySelector(".social__picture"),c=o.querySelector(".social__text");return n.src=e,n.alt=t,c.textContent=r,o})(e);t.appendChild(r)})),t})(e.splice(0,5));H.appendChild(t)},J=t=>{e(t)&&K()},K=()=>{U.classList.remove("modal-open"),z.classList.add("hidden"),document.removeEventListener("keydown",J)};P.addEventListener("click",(()=>{document.removeEventListener("keydown",J),K()}));const Q=document.querySelector(".pictures"),X=document.querySelector("#picture").content.querySelector(".picture"),Y=e=>{const t=document.createDocumentFragment();e.forEach((e=>{const r=X.cloneNode(!0);r.querySelector(".picture__img").src=e.url,r.querySelector(".picture__comments").textContent=e.comments.length,r.querySelector(".picture__likes").textContent=e.likes,t.appendChild(r),r.addEventListener("click",(()=>{(({url:e,description:t,comments:r,likes:o})=>{U.classList.add("modal-open"),z.classList.remove("hidden"),document.addEventListener("keydown",J),A.src=e,T.textContent=o,I.textContent=N=r.length,M.textContent=t,D=r.slice(),r.length>5?(O.classList.remove("hidden"),O.addEventListener("click",B)):O.classList.add("hidden"),j=D.length>5?5:D.length,R.textContent=j,H.innerHTML="",G(D)})(e)}))})),Q.appendChild(t)};r(136),r(543);const Z=document.querySelector(".img-filters"),ee=document.querySelector(".img-filters__form"),te=document.querySelectorAll(".img-filters__button"),re=()=>{document.querySelectorAll(".picture").forEach((e=>e.remove()))};var oe,ne;g.addEventListener("submit",(e=>{e.preventDefault(),((e,t,r)=>{fetch(y,{method:"POST",body:r}).then((r=>{r.ok?e():t(v)})).catch((()=>{t(v)}))})(V,F,new FormData(e.target))})),oe=e=>{Y(e),Z.classList.remove("img-filters--inactive"),(e=>{ee.addEventListener("click",_.debounce((t=>((e,t)=>{if(!e.target.classList.contains("img-filters__button--active")&&e.target.classList.contains("img-filters__button"))switch(te.forEach((e=>e.classList.remove("img-filters__button--active"))),e.target.classList.add("img-filters__button--active"),e.target.id){case"filter-default":re(),Y(t);break;case"filter-random":re(),(e=>{const t=e.slice(),r=_.shuffle(t).slice(10);Y(r.slice(0,10))})(t);break;case"filter-discussed":re(),(e=>{const t=e.slice().sort(((e,t)=>t.comments.length-e.comments.length));Y(t)})(t)}})(t,e)),500))})(e)},ne=()=>{(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent="Отсутствует связь с сервером. Попробуйте позже",document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})()},fetch(`${y}/data`).then((e=>e.json())).then((e=>{oe(e)})).catch((()=>{ne()}))})()})();
//# sourceMappingURL=main.bundle.js.map